<!doctype html>
<html lang="en" class="dark">
<head>
  <meta charset="utf-8" />
  <title>LoanAI Assistant</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            neon: '#38bdf8'
          },
          boxShadow: {
            neon: '0 0 25px rgba(56,189,248,0.6)'
          }
        }
      }
    }
  </script>
</head>

<body class="min-h-screen bg-gradient-to-br from-black via-slate-900 to-black dark:text-white text-black">

<!-- HEADER -->
<header class="flex items-center justify-between px-6 py-4 border-b border-slate-800">
  <div class="flex items-center gap-3">
    <div class="h-10 w-10 rounded-xl bg-sky-500 flex items-center justify-center font-bold text-black">
      AI
    </div>
    <h1 class="text-lg font-semibold">LoanAI Assistant</h1>
  </div>

  <div class="flex items-center gap-4">
    <button onclick="toggleTheme()"
      class="px-3 py-1 rounded-lg border border-slate-600 text-sm">
      üåô / ‚òÄÔ∏è
    </button>
    <a href="./index.html" class="text-sky-400 hover:underline">
      Back to Home
    </a>
  </div>
</header>

<!-- CHAT AREA -->
<main id="chat"
  class="flex flex-col gap-6 px-6 py-6 overflow-y-auto"
  style="height: calc(100vh - 170px);">

  <!-- Welcome -->
  <div class="flex items-start gap-3 max-w-2xl">
    <div class="h-9 w-9 rounded-full bg-sky-500 flex items-center justify-center font-bold text-black">
      AI
    </div>
    <div class="bg-slate-900 border border-sky-500/30 rounded-xl px-4 py-3 shadow-neon">
      <p>Hello! üëã I‚Äôm your LoanAI assistant.</p>
      <p class="text-sm text-slate-300 mt-1">
        Ask about eligibility, EMI, KYC, or loan offers.
      </p>
      <span class="text-xs text-slate-400 mt-2 block">Just now</span>
    </div>
  </div>

</main>

<!-- INPUT BAR -->
<footer class="border-t border-slate-800 px-6 py-4 bg-black/40 backdrop-blur">
  <div class="flex items-center gap-3">

    <!-- File Upload -->
    <label class="cursor-pointer">
      <input type="file" id="fileInput" hidden onchange="fileSelected(this)">
      <div class="h-10 w-10 flex items-center justify-center rounded-xl
                  border border-slate-600 hover:border-sky-500">
        ‚¨ÜÔ∏è
      </div>
    </label>

    <input
      id="msg"
      placeholder="Ask something..."
      class="flex-1 bg-slate-900 px-4 py-3 rounded-xl
             border border-slate-700 focus:outline-none
             focus:ring-2 focus:ring-sky-500"
      onkeydown="if(event.key==='Enter') send()"
    />

    <button onclick="send()"
      class="bg-sky-500 hover:bg-sky-400 text-black font-semibold
             px-6 py-3 rounded-xl">
      Send
    </button>
  </div>

  <p id="fileName" class="text-xs text-slate-400 mt-2"></p>
</footer>

<script>
const chat = document.getElementById("chat");
const input = document.getElementById("msg");
const fileName = document.getElementById("fileName");

function timestamp() {
  return new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
}

function toggleTheme() {
  document.documentElement.classList.toggle("dark");
}

function fileSelected(input) {
  if (input.files.length > 0) {
    fileName.textContent = "üìé " + input.files[0].name;
  }
}

function addUserMessage(text) {
  const div = document.createElement("div");
  div.className = "flex justify-end";
  div.innerHTML = `
    <div class="bg-sky-500 text-black px-4 py-3 rounded-xl max-w-md shadow-neon">
      ${text}
      <div class="text-xs text-black/70 mt-1 text-right">${timestamp()}</div>
    </div>`;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

function addTyping() {
  const div = document.createElement("div");
  div.id = "typing";
  div.className = "flex items-start gap-3";
  div.innerHTML = `
    <div class="h-9 w-9 rounded-full bg-sky-500 flex items-center justify-center font-bold text-black">
      AI
    </div>
    <div class="bg-slate-900 px-4 py-3 rounded-xl border border-sky-500/30 shadow-neon">
      <span class="animate-pulse">Typing...</span>
    </div>`;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

function removeTyping() {
  const t = document.getElementById("typing");
  if (t) t.remove();
}

function streamAIResponse(text) {
  const words = text.split(" ");
  let i = 0;

  const div = document.createElement("div");
  div.className = "flex items-start gap-3 max-w-2xl";
  const bubble = document.createElement("div");
  bubble.className = "bg-slate-900 border border-sky-500/30 rounded-xl px-4 py-3 shadow-neon";
  const content = document.createElement("span");

  bubble.appendChild(content);
  div.innerHTML = `
    <div class="h-9 w-9 rounded-full bg-sky-500 flex items-center justify-center font-bold text-black">
      AI
    </div>`;
  div.appendChild(bubble);
  chat.appendChild(div);

  const interval = setInterval(() => {
    content.textContent += words[i] + " ";
    i++;
    chat.scrollTop = chat.scrollHeight;
    if (i >= words.length) {
      clearInterval(interval);
      bubble.innerHTML += `<div class="text-xs text-slate-400 mt-2">${timestamp()}</div>`;
    }
  }, 60);
}

async function send() {
  const q = input.value.trim();
  if (!q) return;

  addUserMessage(q);
  input.value = "";
  fileName.textContent = "";

  addTyping();

  try {
    const res = await fetch("https://loanai-backend.onrender.com/chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message: q })
    });

    const data = await res.json();
    removeTyping();
    streamAIResponse(data.reply || "No response.");

  } catch (e) {
    removeTyping();
    streamAIResponse("‚ö†Ô∏è Unable to connect to server.");
  }
}
</script>

</body>
</html>
