<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI Chatbot â€” LoanAI</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: "#0ea5ff",
            electric: "#38bdf8",
            accent: "#0f172a",
          },
          boxShadow: {
            neon: "0 8px 40px rgba(14,165,255,0.25), 0 4px 14px rgba(56,189,248,0.12)",
          },
        },
      },
    };
  </script>

  <style>
    body {
      font-family: Inter, ui-sans-serif, system-ui;
      background: radial-gradient(circle at 20% 20%, rgba(14,165,255,0.15), transparent 40%),
                  radial-gradient(circle at 80% 80%, rgba(124,58,237,0.15), transparent 40%),
                  #000;
    }

    @keyframes floatGlow {
      0%, 100% { transform: translateY(0); box-shadow: 0 0 20px rgba(14,165,255,0.25); }
      50% { transform: translateY(-6px); box-shadow: 0 0 35px rgba(124,58,237,0.35); }
    }
    .chat-window-float { animation: floatGlow 4s ease-in-out infinite; }

    @keyframes floatUp {
      from {opacity:0; transform:translateY(20px);}
      to {opacity:1; transform:translateY(0);}
    }
    .animate-floatUp { animation: floatUp .75s ease-out both; }

    .glass {
      background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
      backdrop-filter: blur(12px);
    }

    .upload-btn:hover svg { filter: drop-shadow(0 0 6px #0ea5ff); }
  </style>
</head>

<body class="text-gray-200 h-screen flex flex-col">

<!-- Header -->
<header class="bg-black/70 backdrop-blur-md border-b border-gray-800 p-4 flex items-center justify-between shadow-neon chat-window-float">
  <div class="flex items-center gap-3">
    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-primary to-electric flex items-center justify-center shadow-neon">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-black" fill="currentColor">
        <path d="M12 2L3 7v6c0 5 3.5 9.7 9 11 5.5-1.3 9-6 9-11V7l-9-5z"/>
      </svg>
    </div>
    <h1 class="text-xl font-bold">LoanAI Assistant</h1>
  </div>

  <a href="index.html" class="text-primary text-sm hover:underline">Back to Home</a>
</header>

<!-- Chat Window -->
<div id="chatWindow"
     class="flex-1 overflow-y-auto p-6 space-y-4 animate-floatUp chat-window-float
            border-x border-gray-800 bg-black/40 backdrop-blur-xl">

  <!-- Welcome Message -->
  <div class="flex items-start gap-3 animate-floatUp">
    <div class="w-10 h-10 rounded-full bg-primary text-black flex items-center justify-center font-bold shadow-neon">
      AI
    </div>
    <div class="max-w-xl p-4 rounded-xl glass border border-blue-800/40 shadow-neon">
      <p class="text-gray-300">
        Hello! ðŸ‘‹ I'm your LoanAI assistant.<br>
        I can help with eligibility checks, EMI calculations, loan offers, KYC, and admin/user workflows.
      </p>
    </div>
  </div>

</div>

<!-- Input Section -->
<div class="p-4 border-t border-gray-800 bg-black/60 backdrop-blur-md">
  <form id="chatForm" class="flex items-center gap-3 max-w-4xl mx-auto">

    <!-- Upload -->
    <label class="cursor-pointer upload-btn">
      <input type="file" id="fileUpload" class="hidden">
      <div class="p-3 rounded-xl border border-gray-700 hover:bg-white/5 transition flex items-center justify-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-primary"
             fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round"
                d="M12 16V4m0 0l-4 4m4-4l4 4M6 20h12" />
        </svg>
      </div>
    </label>

    <input id="chatInput" type="text"
           placeholder="Ask something..."
           class="flex-1 p-3 rounded-xl bg-transparent border border-gray-700 
                  focus:ring-2 focus:ring-primary outline-none text-gray-200" />

    <button class="px-5 py-3 bg-primary text-black rounded-xl font-semibold shadow-neon hover:brightness-110 transition">
      Send
    </button>
  </form>
</div>

<script>
const form = document.getElementById("chatForm");
const input = document.getElementById("chatInput");
const chatWindow = document.getElementById("chatWindow");

/* Add message UI */
function addMessage(text, sender) {
  const bubble = document.createElement("div");
  bubble.className = "flex items-start gap-3 animate-floatUp";

  if (sender === "user") {
    bubble.innerHTML = `
      <div class="flex-1 text-right">
        <div class="inline-block max-w-xl p-3 rounded-xl bg-primary text-black font-medium shadow-neon">${text}</div>
      </div>
      <div class="w-10"></div>`;
  } else {
    bubble.innerHTML = `
      <div class="w-10 h-10 rounded-full bg-primary text-black flex items-center justify-center font-bold shadow-neon">AI</div>
      <div class="max-w-xl p-3 rounded-xl glass border border-blue-800/40 shadow-neon text-gray-300">${text}</div>`;
  }

  chatWindow.appendChild(bubble);
  chatWindow.scrollTop = chatWindow.scrollHeight;
}

/* Typing indicator */
function showTyping() {
  const typing = document.createElement("div");
  typing.id = "typingIndicator";
  typing.className = "flex items-start gap-3 animate-floatUp opacity-70";

  typing.innerHTML = `
    <div class="w-10 h-10 rounded-full bg-primary text-black flex items-center justify-center font-bold shadow-neon">AI</div>
    <div class="max-w-xl p-3 rounded-xl glass border border-blue-800/40 shadow-neon">
      <span class="text-gray-400 italic">AI is typing...</span>
    </div>`;
    
  chatWindow.appendChild(typing);
}

function removeTyping() {
  const t = document.getElementById("typingIndicator");
  if (t) t.remove();
}

/* Handle Chat */
form.addEventListener("submit", async function (e) {
  e.preventDefault();
  const text = input.value.trim();
  if (!text) return;

  addMessage(text, "user");
  input.value = "";

  showTyping();

  const reply = await askLoanAI(text);
  removeTyping();

  addMessage(reply, "ai");
});

/* BACKEND CALL */
async function askLoanAI(question) {
  try {
    const response = await fetch("https://loanai-backend.onrender.com/chat", {   // <-- backend URL
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message: question })
    });

    const data = await response.json();
    return data.reply || "âš ï¸ No reply from server.";
  } catch (error) {
    return "âš ï¸ Backend not reachable. Make sure server.py is running.";
  }
}

</script>

</body>
</html>
